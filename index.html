<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REDIP OCCIDENTAL - CPNB</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #0c2440 0%, #1a365d 50%, #2c5282 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            overflow-x: hidden;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            width: 100%;
            max-width: 950px;
            padding: 40px;
            position: relative;
            overflow: hidden;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #ffcc00 0%, #ff6b00 50%, #ffcc00 100%);
        }
        .logo-container {
            text-align: center;
            margin-bottom: 25px;
        }
        .logo-img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin: 0 auto 15px;
            display: block;
        }
        .title {
            text-align: center;
            color: #0c2440;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 25px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        .section-title {
            font-size: 18px;
            color: #0c2440;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            font-size: 14px;
            color: #2d3748;
            margin-bottom: 6px;
            font-weight: 600;
        }
        .input-group select, .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 15px;
        }
        .item-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .item-row label {
            flex: 1;
            font-size: 14px;
            color: #2d3748;
        }
        .item-row select {
            width: 120px;
            margin-left: 15px;
        }
        .item-row input[type="text"] {
            width: 100px;
            margin-left: 15px;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-guardar {
            background: linear-gradient(135deg, #0c2440, #1a365d);
            color: white;
        }
        .btn-historial {
            background: linear-gradient(135deg, #3182ce, #2c5282);
            color: white;
        }
        .btn-estadisticas {
            background: linear-gradient(135deg, #38a169, #2f855a);
            color: white;
        }
        .btn-resumen {
            background: linear-gradient(135deg, #d69e2e, #b7791f);
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .back-btn {
            background: #2c5282;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .mensaje {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        .exito { background: #c6f6d5; color: #22543d; }
        .error { background: #fed7d7; color: #9b2c2c; }
        @media (max-width: 768px) {
            .container { padding: 25px; }
            .item-row { flex-direction: column; align-items: flex-start; }
            .item-row select, .item-row input[type="text"] {
                margin-left: 0;
                margin-top: 8px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <img src="https://raw.githubusercontent.com/Sistemasupervision/sistema-cpnb/main/iamagenes/LOGO-PNB.png" alt="Logo CPNB" class="logo-img">
            <h1 class="title">REDIP OCCIDENTAL</h1>
        </div>
        <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Volver al Panel Principal</button>
        <div class="section">
            <h2 class="section-title">Datos de la Inspecci√≥n</h2>
            <div class="input-group">
                <label for="ccp">CCP:</label>
                <select id="ccp" required>
                    <option value="">-- Seleccione CCP --</option>
                    <option value="metropolitano">CCP METROPOLITANO</option>
                    <option value="sur-del-lago">CCP SUR DEL LAGO</option>
                    <option value="guajira">CCP GUAJIRA</option>
                    <option value="col">CCPE COL</option>
                    <option value="lara">CCPE LARA</option>
                    <option value="falcon">CCPE FALC√ìN</option>
                </select>
            </div>
            <div class="input-group">
                <label for="estacion">Estaci√≥n Policial:</label>
                <select id="estacion" disabled required>
                    <option value="">-- Primero seleccione CCP --</option>
                </select>
            </div>
            <div class="input-group">
                <label for="proximaInspeccion">Pr√≥xima Inspecci√≥n:</label>
                <input type="date" id="proximaInspeccion" required>
            </div>
            <div class="input-group">
                <label for="observacionesGenerales">Observaciones Generales:</label>
                <textarea id="observacionesGenerales" rows="4" placeholder="Escriba observaciones generales de la inspecci√≥n..."></textarea>
            </div>
        </div>
        <div class="section">
            <h2 class="section-title">√çtems de Inspecci√≥n (67)</h2>
            <div id="itemsContainer">
                <!-- Los √≠tems se generar√°n din√°micamente -->
            </div>
        </div>
        <div class="btn-container">
            <button class="btn btn-guardar" id="btnGuardar" onclick="guardarInspeccion()">
                ‚úÖ Guardar Inspecci√≥n
            </button>
            <button class="btn btn-historial" onclick="window.location.href='historial.html'">
                üìã Ver Historial
            </button>
            <button class="btn btn-estadisticas" onclick="window.location.href='estadisticas.html'">
                üìä Estad√≠sticas por Estaci√≥n
            </button>
            <button class="btn btn-resumen" onclick="window.location.href='resumen-mensual.html'">
                üìÖ Resumen Mensual
            </button>
        </div>
        <div id="mensaje" class="mensaje"></div>
    </div>

    <!-- Modal de carga con barra de progreso -->
    <div id="loadingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; justify-content: center; align-items: center; flex-direction: column; color: white; font-family: Arial, sans-serif;">
        <div style="background: white; padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 6px 20px rgba(0,0,0,0.4);">
            <h3 style="color: #0c2440; margin-bottom: 15px;">Guardando inspecci√≥n...</h3>
            <div style="height: 12px; background: #e2e8f0; border-radius: 6px; overflow: hidden; margin-bottom: 10px;">
                <div id="progressBar" style="height: 100%; width: 0%; background: linear-gradient(90deg, #3182ce, #0c2440); transition: width 0.3s ease;"></div>
            </div>
            <div id="progressText" style="font-size: 14px; color: #4a5568;">0%</div>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://ksczzvtgncvxfrmtvmll.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtzY3p6dnRnbmN2eGZybXR2bWxsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3NjMyMzcsImV4cCI6MjA3NDMzOTIzN30.AuWa3uaRylpXhz_VUh097k5tgNHuDllN8j-Hrktwzno';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);
        let guardando = false;

        const nombresItems = {
            nombramiento_comandante: "1. Verificar el nombramiento como comandante de la unidad.",
            acta_entrega_recepcion: "2. Revisar acta de entrega y recepci√≥n de la unidad. Verifique los asuntos pendientes y las acciones tomadas.",
            dossier_comandante: "3. Verificar que el comandante posea el dossier con documentos de la unidad (creaci√≥n, justificaci√≥n, propiedad, etc.).",
            conocimiento_ley_organica: "4. Verificar conocimiento sobre la Ley Org√°nica del Servicio de Polic√≠a y Ley del CPNB.",
            conocimiento_estatuto_personal: "5. Verificar conocimiento sobre el Reglamento del Estatuto de la Funci√≥n Policial (administraci√≥n de personal).",
            conocimiento_reglamento_disciplinario: "6. Verificar conocimiento sobre el Reglamento de la Funci√≥n Policial y R√©gimen Disciplinario.",
            estructura_organizativa: "7. Verificar conocimiento de la estructura organizativa del CPNB y aplicaci√≥n en la unidad.",
            manuales_normas_procedimientos: "8. Verificar manuales de normas, organizaci√≥n y procedimientos operativos (si aplica).",
            plan_trabajo_anual: "9. Verificar el Plan de Trabajo Anual (POA), cumplimiento y logros.",
            infraestructura_identificacion: "10. Verificar identificaci√≥n adecuada de infraestructuras f√≠sicas.",
            direccion_atencion_victima: "11. Verificar activaci√≥n de Direcci√≥n de Atenci√≥n a la V√≠ctima, Brigada Especial, Oficina de DDHH, etc.",
            oficina_gestion_humana: "12. Verificar con Oficina de Gesti√≥n Humana: relaci√≥n de personal, fichas, vacaciones, ascensos, etc.",
            documentacion_personal: "13. Constatar documentaci√≥n del personal (carnet policial, c√©dula, licencia, declaraci√≥n de renta, etc.).",
            uniforme_presentacion: "14. Constatar uso correcto del uniforme y presentaci√≥n personal (corte de cabello, botas, u√±as, etc.).",
            practica_induccion_orden_publico: "15. Verificar pr√°ctica de inducci√≥n en orden p√∫blico (planes de reacci√≥n inmediata, defensa, evacuaci√≥n).",
            entrenamiento_armamento: "16. Verificar entrenamiento en manejo de armamento org√°nico.",
            talleres_manejo_defensivo: "17. Verificar talleres de manejo defensivo y seguridad vial para conductores.",
            conocimientos_primeros_auxilios: "18. Verificar conocimientos m√≠nimos de primeros auxilios en el personal.",
            acciones_moral_disciplina: "19. Verificar acciones para elevar moral, disciplina, esp√≠ritu de cuerpo y bienestar del personal.",
            conocimiento_pensamiento_bolivariano: "20. Verificar conocimiento del pensamiento bolivariano (Sim√≥n Bol√≠var y Hugo Ch√°vez).",
            instruccion_etica_moral: "21. Verificar instrucci√≥n constante sobre honestidad, √©tica y esp√≠ritu de cuerpo.",
            talleres_ministerio_publico: "22. Verificar talleres dictados por Ministerio P√∫blico sobre debido proceso y DDHH.",
            conocimiento_lineamientos_cpnb: "23. Constatar conocimiento de lineamientos del CPNB y acciones de difusi√≥n.",
            cursos_sustanciacion_expedientes: "24. Constatar cursos de sustanciaci√≥n de expedientes, actas policiales y pericias judiciales.",
            cumplimiento_entrenamiento_fisico: "25. Verificar cumplimiento de entrenamiento: educaci√≥n f√≠sica y orden cerrado.",
            dotacion_trajes_antimotines: "26. Verificar dotaci√≥n suficiente de trajes antimotines.",
            practica_tecnicas_policiales: "27. Verificar pr√°ctica de: manejo de armas, tiro de combate, mantenimiento, t√©cnicas policiales, uso progresivo de la fuerza, etc.",
            numero_funcionarios_suficiente: "28. Constatar que el n√∫mero de funcionarios sea suficiente para los servicios policiales.",
            personal_empleado_servicios: "29. Verificar que el personal est√© siendo empleado para cumplir servicios policiales.",
            servicios_autorizados_mpprijp: "30. Verificar que solo se presten servicios autorizados por MPPRIJP y Comando General.",
            publicaciones_procedimientos: "31. Verificar publicaciones de procedimientos: backing institucional, uso de mes√≥n, fotos n√≠tidas, sin efectivos en fotos.",
            libros_novedades: "32. Verificar en libros de novedades: izada de bandera, formaciones diarias, comisiones, prohibici√≥n de persecuciones, uso de chaleco.",
            libro_actas_reuniones: "33. Verificar existencia del libro de actas de reuniones con entes gubernamentales o privados.",
            libro_reuniones_personal: "34. Verificar existencia del libro de reuniones con personal policial y planificaciones semanales.",
            archivo_general_expedientes: "35. Verificaci√≥n del archivo general de expedientes.",
            libro_entrevistas_funcionarios: "36. Verificar el libro de entrevistas con funcionarios.",
            supervision_libros: "37. Supervisar anotaciones en libros: armamento, inspecci√≥n de servicios, √≥rdenes permanentes, ronda, operaciones.",
            cumplimiento_normativa_instalaciones: "38. Verificar cumplimiento de normativa para parque de armas y sala de evidencias.",
            bienes_publicos_registrados: "39. Verificar que los bienes p√∫blicos coincidan con los registrados en Gesti√≥n Administrativa.",
            resguardo_detenido: "40. Verificar condiciones de resguardo del detenido: seguridad, control, condiciones de funcionarios y privados de libertad.",
            equipos_control_incendios: "41. Verificar existencia y operatividad de equipos de control de incendios.",
            equipos_comunicacion: "42. Verificar cantidad y condici√≥n de equipos de comunicaci√≥n.",
            plan_hospedaje_personal: "43. Verificar que el comandante tenga previsto un plan de hospedaje para personal de apoyo.",
            calidad_vida_personal: "44. Verificar calidad de vida, alimentaci√≥n, servicios b√°sicos y bienestar del personal.",
            plan_visita_estaciones: "45. Verificar plan de visita a estaciones policiales de la jurisdicci√≥n.",
            servicio_medico: "46. Verificar si existe un servicio m√©dico en la unidad.",
            unidad_recepcion_denuncias: "47. Verificar existencia de unidad de recepci√≥n de denuncias en coordinaci√≥n con entes.",
            areas_esparcimiento: "48. Constatar condiciones de √°reas de esparcimiento (comedores, dormitorios, muebles, etc.).",
            vehiculos_operativos: "49. Constatar cantidad de veh√≠culos operativos/inoperativos y plan de mantenimiento.",
            placa_policial_vehiculos: "50. Verificar que todos los veh√≠culos tengan placa policial.",
            vehiculos_suficientes: "51. Verificar si la cantidad de veh√≠culos operativos es suficiente.",
            vehiculos_donados_inventario: "52. Verificar si veh√≠culos donados est√°n incluidos en inventario nacional.",
            accesorios_seguridad_vehiculos: "53. Verificar accesorios de seguridad en veh√≠culos.",
            necesidades_repuestos_vehiculos: "54. Constatar necesidades de repuestos, cauchos y accesorios.",
            identificacion_vehiculos_policiales: "55. Verificar identificaci√≥n de veh√≠culos con logos, cautelera y equipo P.A.",
            informes_parques_armas: "56. Verificar informes de inspecci√≥n a parques de armas y acta de inspecci√≥n.",
            supervision_pac: "57. Verificar supervisi√≥n de Puntos de Atenci√≥n al Ciudadano (PAC) y flujo de productos esenciales.",
            vademecum_actualizado: "58. Verificar vadem√©cum general actualizado.",
            despliegues_policiales: "59. Supervisar cumplimiento de despliegues policiales y actividades extraordinarias.",
            supervision_personal_mando: "60. Constatar mayor supervisi√≥n y control sobre el personal (principio de mando).",
            planes_contra_trafico_ilicito: "61. Verificar planes contra tr√°fico il√≠cito, alimentos, hidrocarburos, armamento, etc.",
            conocimiento_lineamientos_derechos_humanos: "62. Constatar conocimiento de lineamientos en DDHH, orden p√∫blico, atenci√≥n a v√≠ctimas, etc.",
            registro_actuaciones_cop: "63. Verificar registro de actuaciones positivas/negativas en el COP por cuadrante.",
            rendicion_procedimientos_cop: "64. Verificar rendici√≥n de procedimientos al COP para consolidaci√≥n.",
            archivos_informes_rendicion: "65. Revisi√≥n de archivos de informes de rendici√≥n de cuenta.",
            informes_preliminares_actuacion: "66. Verificar elaboraci√≥n de informes preliminares de actuaci√≥n policial.",
            estatus_procesos_administrativos: "67. Verificar estatus de procesos administrativos ante la ICAP."
        };

        // Cargar estaciones al cambiar CCP
        document.getElementById('ccp').addEventListener('change', async () => {
            const ccp = document.getElementById('ccp').value;
            const estacionSelect = document.getElementById('estacion');
            estacionSelect.innerHTML = '<option value="">-- Cargando... --</option>';
            estacionSelect.disabled = true;
            if (!ccp) {
                estacionSelect.innerHTML = '<option value="">-- Seleccione CCP primero --</option>';
                return;
            }
            try {
                const { data: estaciones, error } = await supabase
                    .from('estaciones_policiales')
                    .select('id, nombre')
                    .eq('ccp_id', ccp)
                    .order('nombre', { ascending: true });
                estacionSelect.innerHTML = '<option value="">-- Seleccione Estaci√≥n --</option>';
                if (error || !estaciones || estaciones.length === 0) {
                    estacionSelect.innerHTML = '<option value="">No hay estaciones</option>';
                    return;
                }
                estaciones.forEach(est => {
                    const opt = document.createElement('option');
                    opt.value = est.id;
                    opt.textContent = est.nombre;
                    estacionSelect.appendChild(opt);
                });
                estacionSelect.disabled = false;
            } catch (err) {
                console.error(err);
                estacionSelect.innerHTML = '<option value="">Error al cargar</option>';
            }
        });

        // Generar los 67 √≠tems
        function generarItems() {
            const container = document.getElementById('itemsContainer');
            container.innerHTML = '';
            Object.entries(nombresItems).forEach(([key, nombre]) => {
                const div = document.createElement('div');
                div.className = 'item-row';
                div.innerHTML = `
                    <label>${nombre}</label>
                    <select name="cumple_${key}" required>
                        <option value="">--</option>
                        <option value="true">S√≠</option>
                        <option value="false">No</option>
                    </select>
                    <input type="text" name="porcentaje_${key}" placeholder="% (0-100)" maxlength="3" style="width: 80px;">
                    <input type="text" name="observacion_${key}" placeholder="Observaci√≥n (opcional)" style="flex: 1; margin-left: 15px;">
                `;
                container.appendChild(div);
            });
        }

        // Verificar acceso
        async function verificarAcceso() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                alert('Debe iniciar sesi√≥n.');
                window.location.href = 'index.html';
                return false;
            }
            try {
                const { data, error } = await supabase
                    .from('usuarios_redip')
                    .select('redip')
                    .eq('user_id', user.id)
                    .single();
                if (error || !data || (data.redip !== 'occidental' && data.redip !== 'admin')) {
                    alert('‚ö†Ô∏è No tiene permisos para acceder a REDIP OCCIDENTAL.');
                    window.location.href = 'index.html';
                    return false;
                }
                return true;
            } catch (err) {
                console.error(err);
                alert('Error al verificar permisos.');
                return false;
            }
        }

        // Funci√≥n para mostrar mensaje
        function mostrarMensaje(texto, tipo) {
            const msg = document.getElementById('mensaje');
            msg.textContent = texto;
            msg.className = `mensaje ${tipo}`;
            msg.style.display = 'block';
            setTimeout(() => { msg.style.display = 'none'; }, 5000);
        }

        // Funci√≥n para actualizar progreso
        function updateProgress(porcentaje, texto = '') {
            const bar = document.getElementById('progressBar');
            const text = document.getElementById('progressText');
            if (bar) bar.style.width = `${porcentaje}%`;
            if (text) text.textContent = `${porcentaje}% ${texto ? `‚Äî ${texto}` : ''}`;
        }

        // Guardar inspecci√≥n
        async function guardarInspeccion() {
            if (guardando) return;
            guardando = true;

            const btn = document.getElementById('btnGuardar');
            const form = document.querySelector('.container');
            btn.disabled = true;
            btn.textContent = 'Guardando...';
            form.style.pointerEvents = 'none';
            form.style.opacity = '0.85';

            document.getElementById('loadingModal').style.display = 'flex';
            updateProgress(0, 'Iniciando...');

            try {
                // Validar campos principales
                const ccp = document.getElementById('ccp').value;
                const estacionId = document.getElementById('estacion').value;
                const proxima = document.getElementById('proximaInspeccion').value;
                if (!ccp || !estacionId || !proxima) {
                    throw new Error('Complete todos los campos obligatorios.');
                }

                // Obtener usuario
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) throw new Error('Sesi√≥n inv√°lida.');

                updateProgress(10, 'Creando inspecci√≥n...');

                // Crear inspecci√≥n
                const { data: insp, error: inspError } = await supabase
                    .from('inspecciones')
                    .insert({
                        estacion_id: parseInt(estacionId),
                        inspector_email: user.email,
                        proxima_inspeccion: proxima,
                        observaciones_generales: document.getElementById('observacionesGenerales').value.trim() || null
                    })
                    .select()
                    .single();

                if (inspError) throw inspError;

                updateProgress(30, 'Preparando √≠tems...');

                // Recoger √≠tems
                const items = [];
                Object.keys(nombresItems).forEach(key => {
                    const cumpleEl = document.querySelector(`select[name="cumple_${key}"]`);
                    const porcentajeEl = document.querySelector(`input[name="porcentaje_${key}"]`);
                    const observacionEl = document.querySelector(`input[name="observacion_${key}"]`);

                    let cumple = null;
                    if (cumpleEl.value === 'true') cumple = true;
                    else if (cumpleEl.value === 'false') cumple = false;

                    let porcentaje = null;
                    if (porcentajeEl.value && !isNaN(porcentajeEl.value)) {
                        porcentaje = Math.min(100, Math.max(0, parseInt(porcentajeEl.value)));
                    }

                    const observacion = observacionEl.value.trim() || null;

                    if (cumple !== null) {
                        items.push({
                            inspeccion_id: insp.id,
                            item_nombre: key,
                            cumple: cumple,
                            porcentaje_cumplimiento: porcentaje,
                            observacion: observacion
                        });
                    }
                });

                if (items.length === 0) {
                    throw new Error('Debe responder al menos un √≠tem.');
                }

                updateProgress(60, `Guardando ${items.length} √≠tems...`);

                // Insertar √≠tems
                const { error: itemsError } = await supabase
                    .from('items_inspeccion')
                    .insert(items);

                if (itemsError) throw itemsError;

                updateProgress(100, '¬°Listo!');

                setTimeout(() => {
                    mostrarMensaje('‚úÖ Inspecci√≥n guardada correctamente.', 'exito');
                    document.getElementById('itemsContainer').scrollIntoView({ behavior: 'smooth' });
                }, 400);

            } catch (error) {
                console.error('Error:', error);
                mostrarMensaje(`‚ùå ${error.message || 'Error al guardar la inspecci√≥n.'}`, 'error');
                updateProgress(0, 'Error');
            } finally {
                guardando = false;
                btn.disabled = false;
                btn.textContent = '‚úÖ Guardar Inspecci√≥n';
                form.style.pointerEvents = 'auto';
                form.style.opacity = '1';
                setTimeout(() => {
                    document.getElementById('loadingModal').style.display = 'none';
                }, 500);
            }
        }

        // Inicializar
        verificarAcceso().then(permitido => {
            if (permitido) {
                generarItems();
                document.getElementById('proximaInspeccion').min = new Date().toISOString().split('T')[0];
            }
        });
    </script>
</body>
</html>
