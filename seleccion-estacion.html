<div class="logo-container">
    <img src="https://raw.githubusercontent.com/Sistemasupervision/sistema-cpnb/main/iamagenes/LOGO-PNB.png" alt="Logo CPNB" class="logo-img">
    <h1 class="title">Selección de Estación Policial o Servicio</h1>
</div>

<div id="estacionesList" style="margin: 20px 0;">
    <!-- Las estaciones se cargarán aquí dinámicamente -->
    <p style="text-align: center; color: #718096;">Cargando estaciones...</p>
</div>

<div id="addEstacionForm" style="margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 12px;">
    <h3 style="color: #0c2440; margin-bottom: 15px;">Agregar Nueva Estación</h3>
    <div class="input-group">
        <label for="newEstacionName">Nombre de la Estación:</label>
        <input type="text" id="newEstacionName" placeholder="Ej: Comisaría San Francisco" required style="width:100%; padding:12px; border:2px solid #e2e8f0; border-radius:8px;">
    </div>
    <button id="saveEstacionBtn" class="form-btn" style="margin-top:10px; width:100%;">Guardar Estación</button>
</div>

<button id="backToCcpBtn" class="back-btn">← Volver a CCP</button>

<script>
// Esta función se llamará desde el archivo principal
function initSeleccionEstacion(supabaseClient) {
    const supabase = supabaseClient;
    const CCP_ID = 'metropolitano'; // Identificador del CCP actual
    
    // Cargar estaciones desde Supabase
    async function loadEstaciones() {
        try {
            const { data, error } = await supabase
                .from('estaciones_policiales')
                .select('id, nombre')
                .eq('ccp_id', CCP_ID)
                .order('nombre', { ascending: true });
                
            if (error) throw error;
            
            const listDiv = document.getElementById('estacionesList');
            if (data.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #718096;">No hay estaciones registradas</p>';
            } else {
                listDiv.innerHTML = data.map(est => 
                    `<div style="padding: 12px; margin: 8px 0; background: white; border-radius: 8px; border-left: 3px solid #3182ce; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <strong>${est.nombre}</strong>
                    </div>`
                ).join('');
            }
        } catch (error) {
            console.error('Error al cargar estaciones:', error);
            document.getElementById('estacionesList').innerHTML = '<p style="color: #e53e3e; text-align: center;">Error al cargar estaciones</p>';
        }
    }
    
    // Guardar nueva estación
    document.getElementById('saveEstacionBtn').addEventListener('click', async () => {
        const nombre = document.getElementById('newEstacionName').value.trim();
        if (!nombre) {
            alert('Por favor ingrese un nombre para la estación');
            return;
        }
        
        try {
            const { error } = await supabase
                .from('estaciones_policiales')
                .insert({ nombre, ccp_id: CCP_ID });
                
            if (error) throw error;
            
            alert('Estación agregada exitosamente');
            document.getElementById('newEstacionName').value = '';
            loadEstaciones(); // Recargar la lista
        } catch (error) {
            console.error('Error al guardar estación:', error);
            alert('Error al guardar la estación');
        }
    });
    
    // Volver a CCP
    document.getElementById('backToCcpBtn').onclick = () => {
        document.getElementById('dynamicView').style.display = 'none';
        document.getElementById('rediOccidentalContainer').style.display = 'block';
    };
    
    // Cargar estaciones al iniciar
    loadEstaciones();
}
</script>
